---
resources:
- name: test-repo-source
  type: git
  source:
    uri: https://github.com/AdamHawtin/concourse-testing.git
    branch: master

- name: test-repo-release
  type: github-release
  source:
    user: AdamHawtin
    repository: concourse-testing

- name: test-repo-pre-release
  type: github-release
  source:
    user: AdamHawtin
    repository: concourse-testing
    pre_release: true
    release: true

jobs:
- name: test-pre-release-job
  serial: true
  plan:
  - get: test-repo-source
  - get: test-repo-release
  - get: test-repo-pre-release
    trigger: true
  - task: Hello My Friends!
    file: test-repo-source/hello-my-friends.yml
  - task: Get pre release source
    config:
      platform: linux
      image_resource:
        type: docker-image
        source:
          repository: alpine
          tag: latest
      inputs:
      - name: test-repo-pre-release
      outputs:
      - name: test-pre-release-source
      run:
        path: sh
        args:
        - -exc
        - |
          cd test-repo-pre-release
          mkdir test-pre-release-source
          tar -xzf source.tar.gz -C test-pre-release-source --strip-components=1
  - task: Check pre-prelease source
    config:
      platform: linux
      image_resource:
        type: docker-image
        source:
          repository: alpine
          tag: latest
      inputs:
      - name: test-pre-release-source
      run:
        path: sh
        args:
        - -exc
        - |
          cd test-pre-relesae-source
          ls -a

- name: test-release-job
  serial: true
  plan:
  - get: test-repo-release
    trigger: true
    passed: [test-pre-release-job]
  - get: test-repo-source
  - task: Hello My Friends!
    file: test-repo-source/hello-my-friends.yml
